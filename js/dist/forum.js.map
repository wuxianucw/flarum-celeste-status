{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@ucw/flarum-celeste-status/webpack/bootstrap","webpack://@ucw/flarum-celeste-status/webpack/runtime/compat get default export","webpack://@ucw/flarum-celeste-status/webpack/runtime/define property getters","webpack://@ucw/flarum-celeste-status/webpack/runtime/hasOwnProperty shorthand","webpack://@ucw/flarum-celeste-status/webpack/runtime/make namespace object","webpack://@ucw/flarum-celeste-status/external root \"flarum.core.compat['common/app']\"","webpack://@ucw/flarum-celeste-status/./src/common/index.ts","webpack://@ucw/flarum-celeste-status/external root \"flarum.core.compat['forum/app']\"","webpack://@ucw/flarum-celeste-status/external root \"flarum.core.compat['common/extend']\"","webpack://@ucw/flarum-celeste-status/external root \"flarum.core.compat['forum/components/UserCard']\"","webpack://@ucw/flarum-celeste-status/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@ucw/flarum-celeste-status/external root \"flarum.core.compat['common/Component']\"","webpack://@ucw/flarum-celeste-status/external root \"flarum.core.compat['common/components/LoadingIndicator']\"","webpack://@ucw/flarum-celeste-status/external root \"flarum.core.compat['common/components/Button']\"","webpack://@ucw/flarum-celeste-status/./src/forum/components/CelesteStatus.tsx","webpack://@ucw/flarum-celeste-status/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@ucw/flarum-celeste-status/./src/forum/index.tsx"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/app'];","import app from 'flarum/common/app';\n\napp.initializers.add('ucw/flarum-celeste-status', () => {\n  console.log('[ucw/flarum-celeste-status] Hello, forum and admin!');\n});\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/UserCard'];","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Component'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LoadingIndicator'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","import Mithril from 'mithril';\nimport Component, { ComponentAttrs } from 'flarum/common/Component';\nimport User from 'flarum/common/models/User';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\nimport Button from 'flarum/common/components/Button';\n\nexport interface CelesteStatusAttrs extends ComponentAttrs {\n  user: User;\n}\n\nexport interface CelesteStatusState {\n  loading: boolean;\n  disabled: boolean;\n  status: CelesteStatusInfo | null;\n}\n\nexport interface CelesteStatusInfo {\n  ID: number;\n  Name: string;\n  FullName: string;\n  DisplayName: string;\n  Level: string;\n  Sid: string;\n  Side: string;\n  MapName: string;\n  TCPPingMs: number | null;\n  UDPPingMs: number | null;\n}\n\nexport default class CelesteStatus extends Component<CelesteStatusAttrs, CelesteStatusState> {\n\n  oninit(vnode: Mithril.Vnode<CelesteStatusAttrs, this>) {\n    super.oninit(vnode);\n\n    this.state = {\n      loading: true,\n      disabled: false,\n      status: null,\n    };\n\n    this.fetch();\n  }\n\n  view() {\n    const { loading, disabled, status } = this.state;\n\n    if (loading) {\n      return <div className=\"CelesteStatus-container\">{LoadingIndicator.component({ size: 'tiny' })}</div>;\n    }\n\n    return (\n      <div className=\"CelesteStatus-container\">\n        <div className=\"CelesteStatus-refresh\">\n          <Button className=\"Button\" icon=\"fas fa-sync\" onclick={this.fetch.bind(this)} disabled={disabled}>刷新</Button>\n        </div>\n        {status ? (\n          <div className=\"CelesteStatus-content\">\n            {`${status.Name} 正在玩 ${status.MapName} (${status.Side} 面)`}\n          </div>\n        ) : (\n          <div className=\"CelesteStatus-offline\">该玩家当前不在线</div>\n        )}\n      </div>\n    );\n  }\n\n  fetch() {\n    const { user } = this.attrs;\n    const userName = user.username();\n\n    this.state.loading = true;\n\n    m.request({\n      method: 'GET',\n      url: 'http://celesteserver.centralteam.cn:17232/api/player',\n      params: { playername: userName },\n      // deserialize: JSON.parse,\n    }).then((data: any) => {\n      console.log(data);\n      this.state.status = (typeof data === 'object' && typeof data.ID === 'number') ? data : null;\n    }).catch(() => {\n      this.state.status = null;\n    }).finally(() => {\n      this.state.loading = false;\n      this.state.disabled = true;\n      setTimeout(() => {\n        this.state.disabled = false;\n        m.redraw();\n      }, 5000);\n    });\n  }\n}\n","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport UserCard from 'flarum/forum/components/UserCard';\nimport CelesteStatus from './components/CelesteStatus';\n\napp.initializers.add('ucw/flarum-celeste-status', () => {\n  extend(UserCard.prototype, 'infoItems', function (items) {\n    const { user } = this.attrs as any;\n\n    if (!user) {\n      return;\n    }\n\n    // priority -101 to be after the UserBio\n    items.add('celesteStatus', <CelesteStatus user={user} />, -101);\n  });\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","app","console","log","_setPrototypeOf","p","setPrototypeOf","bind","__proto__","CelesteStatus","_Component","subClass","superClass","apply","arguments","create","constructor","_proto","oninit","vnode","this","state","loading","disabled","status","fetch","view","_this$state","m","className","LoadingIndicator","size","Button","icon","onclick","Name","MapName","Side","_this","userName","attrs","user","username","request","method","url","params","playername","then","data","ID","setTimeout","redraw","Component","extend","UserCard","items","add"],"sourceRoot":""}