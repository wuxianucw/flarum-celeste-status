(()=>{var t={n:e=>{var o=e&&e.__esModule?()=>e.default:()=>e;return t.d(o,{a:o}),o},d:(e,o)=>{for(var a in o)t.o(o,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:o[a]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{"use strict";t.r(e);const o=flarum.core.compat["common/app"];t.n(o)().initializers.add("ucw/flarum-celeste-status",(function(){console.log("[ucw/flarum-celeste-status] Hello, forum and admin!")}));const a=flarum.core.compat["forum/app"];var n=t.n(a);const s=flarum.core.compat["common/extend"],r=flarum.core.compat["forum/components/UserCard"];var c=t.n(r);function i(t,e){return i=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},i(t,e)}const l=flarum.core.compat["common/Component"];var u=t.n(l);const d=flarum.core.compat["common/components/LoadingIndicator"];var p=t.n(d);const f=flarum.core.compat["common/components/Button"];var y=t.n(f),v=function(t){var e,o;function a(){return t.apply(this,arguments)||this}o=t,(e=a).prototype=Object.create(o.prototype),e.prototype.constructor=e,i(e,o);var n=a.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),this.state={loading:!0,disabled:!1,status:null},this.fetch()},n.view=function(){var t=this.state,e=t.loading,o=t.disabled,a=t.status;return e?m("div",{className:"CelesteStatus-container"},p().component({size:"tiny"})):m("div",{className:"CelesteStatus-container"},m("div",{className:"CelesteStatus-refresh"},m(y(),{className:"Button",icon:"fas fa-sync",onclick:this.fetch.bind(this),disabled:o},"刷新")),a?m("div",{className:"CelesteStatus-content"},a.Name+" 正在玩 "+a.MapName+" ("+a.Side+" 面)"):m("div",{className:"CelesteStatus-offline"},"该玩家当前不在线"))},n.fetch=function(){var t=this,e=this.attrs.user.username();this.state.loading=!0,m.request({method:"GET",url:"http://celesteserver.centralteam.cn:17232/api/player",params:{playername:e}}).then((function(e){console.log(e),t.state.status="object"==typeof e&&"number"==typeof e.ID?e:null})).catch((function(){t.state.status=null})).finally((function(){t.state.loading=!1,t.state.disabled=!0,setTimeout((function(){t.state.disabled=!1,m.redraw()}),5e3)}))},a}(u());n().initializers.add("ucw/flarum-celeste-status",(function(){(0,s.extend)(c().prototype,"infoItems",(function(t){var e=this.attrs.user;e&&t.add("celesteStatus",m(v,{user:e}),-101)}))}))})(),module.exports=e})();
//# sourceMappingURL=forum.js.map